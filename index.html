<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>@TDR_PR タイムライン埋め込みテスト</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root { --bg: #fafafa; --fg: #111; }
    @media (prefers-color-scheme: dark) {
      :root { --bg: #0b0b0b; --fg: #f5f5f5; }
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    }
    .wrap {
      display: grid;
      place-items: start center;
      min-height: 100%;
      padding: 24px;
      box-sizing: border-box;
      gap: 16px;
    }
    .card {
      width: min(720px, 100%);
      box-sizing: border-box;
      background: rgba(127,127,127,.06);
      border-radius: 16px;
      padding: 16px;
      backdrop-filter: blur(2px);
    }
    h1 { font-size: 1.1rem; margin: 0 0 8px; }
    .controls { display: flex; gap: 8px; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .row { display: flex; gap: 8px; align-items: center; }
    .btn {
      border: 1px solid rgba(127,127,127,.4);
      background: transparent;
      color: inherit;
      border-radius: 999px;
      padding: 6px 12px;
      cursor: pointer;
    }
    .note { opacity: .7; font-size: .9rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="controls">
        <h1>@TDR_PR タイムライン</h1>
        <div class="row">
          <label class="note">
            高さ:
            <input id="heightInput" type="number" min="300" max="2000" step="20" value="680" style="width:6rem">
            px
          </label>
          <button id="themeBtn" class="btn" type="button">テーマ: 自動</button>
          <button id="reloadBtn" class="btn" type="button">再読み込み</button>
        </div>
      </div>

      <!-- 埋め込み要素（widgets.js 読み込み前に置く） -->
      <div id="timelineHost">
        <a
          id="timeline"
          class="twitter-timeline"
          data-width="100%"
          data-height="680"
          data-lang="ja"
          data-chrome="noheader nofooter noborders transparent"
          data-theme="light"
          href="https://twitter.com/TDR_PR"
        >Posts by @TDR_PR</a>
      </div>

      <p class="note">
        表示されない場合：企業ネットワーク/コンテンツブロッカー/CSPで <code>platform.twitter.com</code> などが遮断されていないか確認してください。
      </p>
    </div>
  </div>

  <script>
    // 「自動/ライト/ダーク」切り替え
    (function () {
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
      const timeline = document.getElementById('timeline');
      const themeBtn = document.getElementById('themeBtn');
      const heightInput = document.getElementById('heightInput');
      const reloadBtn = document.getElementById('reloadBtn');

      let themeMode = 'auto'; // 'auto' | 'light' | 'dark'

      function applyThemeAttr() {
        const useDark = themeMode === 'auto' ? (prefersDark && prefersDark.matches) : (themeMode === 'dark');
        timeline.setAttribute('data-theme', useDark ? 'dark' : 'light');
        themeBtn.textContent = 'テーマ: ' + (themeMode === 'auto' ? '自動' : (useDark ? 'ダーク' : 'ライト'));
      }

      // 高さ変更
      function applyHeightAttr() {
        const h = Math.max(300, Math.min(2000, Number(heightInput.value) || 680));
        timeline.setAttribute('data-height', String(h));
      }

      // ウィジェット再ビルド
      function rebuild() {
        // 既存 iframe を消し、元の <a> を再配置して widgets.js に再ロードさせる
        const host = document.getElementById('timelineHost');
        host.innerHTML = '';
        const a = timeline.cloneNode(true);
        host.appendChild(a);

        // twttr.widgets.load を呼ぶ（まだ読み込まれてなければ後で呼ばれる）
        if (window.twttr && window.twttr.widgets && window.twttr.widgets.load) {
          window.twttr.widgets.load(host);
        }
      }

      // 初期設定
      applyThemeAttr();
      applyHeightAttr();

      // UI イベント
      themeBtn.addEventListener('click', () => {
        themeMode = themeMode === 'auto' ? 'light' : themeMode === 'light' ? 'dark' : 'auto';
        applyThemeAttr();
        rebuild();
      });

      if (prefersDark && prefersDark.addEventListener) {
        prefersDark.addEventListener('change', () => {
          if (themeMode === 'auto') { applyThemeAttr(); rebuild(); }
        });
      }

      heightInput.addEventListener('change', () => { applyHeightAttr(); rebuild(); });
      reloadBtn.addEventListener('click', rebuild);
    })();
  </script>

  <!-- 必須: X(Twitter) ウィジェット -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  <noscript>
    JavaScript を有効にすると @TDR_PR のタイムラインが表示されます。
  </noscript>

<a class="twitter-timeline" href="https://twitter.com/TaXm00001?ref_src=twsrc%5Etfw">Tweets by TaXm00001</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  
</body>
</html>
