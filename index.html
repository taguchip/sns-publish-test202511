<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>X タイムライン埋め込み（429対策）</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; padding: 20px; }
    #host { max-width: 420px; min-height: 620px; border: 1px dashed #aaa; padding: 8px; margin-top: 8px; }
    button { padding: 6px 12px; }
    .note { opacity:.7; font-size:.9rem; }
  </style>
</head>
<body>
  <h1>@TaXm00001 のpost</h1>
  <blockquote class="twitter-tweet">
    <p lang="en" dir="ltr">
      post test2 <a href="https://t.co/GEki92U7o9">pic.twitter.com/GEki92U7o9</a>
    </p>&mdash; taxm (@TaXm00001) 
    <a href="https://twitter.com/TaXm00001/status/1988823985660805504?ref_src=twsrc%5Etfw">November 13, 2025</a>
  </blockquote>
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8">
  </script>
  <h1>@TaXm00001 のタイムライン</h1>
  <button id="retryBtn" type="button">再読み込み</button>
  <span id="status" class="note"></span>
  <div id="host">ここにタイムラインが表示されます。</div>

  <script>
    let initialized = false;
    async function embed() {
      const host = document.getElementById('host');
      const status = document.getElementById('status');
      if (!window.twttr?.widgets?.createTimeline) {
        status.textContent = 'widgetsの準備待ち…';
        return;
      }
      // 二重実行ガード
      if (initialized) return;
      initialized = true;

      host.textContent = '読み込み中…';
      status.textContent = '';
      try {
        const iframe = await window.twttr.widgets.createTimeline(
          { sourceType: 'profile', screenName: 'TaXm00001' },
          host,
          { height: 600, lang: 'ja', chrome: 'noheader nofooter noborders transparent' }
        );
        if (!iframe) {
          initialized = false; // 失敗時は再試行を許す
          status.textContent = '読み込みに失敗（詳細はConsole）';
        }
      } catch (e) {
        initialized = false;
        status.textContent = '読み込みエラー（Console参照）';
        console.error('createTimeline failed:', e);
      }
    }

    document.getElementById('retryBtn').addEventListener('click', () => {
      initialized = false; // 明示的に再試行
      embed();
    });

    window.addEventListener('load', () => {
      if (window.twttr?.ready) window.twttr.ready(embed);
      else embed();
    });
  </script>

  <script async src="https://platform.twitter.com/widgets.js"
          charset="utf-8"
          onload="console.log('widgets.js loaded')"
          onerror="console.log('widgets.js failed to load')"></script>
</body>
</html>
